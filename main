from aiogram import Bot, Dispatcher, executor
from t import TOKEN, admin_id
from aiogram.types import Message, InlineKeyboardButton, InlineKeyboardMarkup, \
    ReplyKeyboardMarkup,KeyboardButton, ReplyKeyboardRemove, CallbackQuery
from get_data import get_data, get_prefix, get_books_name, \
    get_subjects_for_num, get_all_links_for_subject
from dictionary import d_subjects
from aiogram.dispatcher import FSMContext
from aiogram.contrib.fsm_storage.memory import MemoryStorage
from t import chat_for_books_id
from aiogram.utils.callback_data import CallbackData
from aiogram.dispatcher.filters.state import StatesGroup, State
from math import ceil
d = dict()


def make_murkup(prefix:str, lst_link:str):
    markup = InlineKeyboardMarkup(row_width=3)
    for i in range(len(lst_link)):
        markup.insert(InlineKeyboardButton(text=f'{i+1}', callback_data=f'{prefix[i]}'))
    global d
    d = dict(zip(prefix, lst_link))
    return markup


def make_temp_murkup(subjects_num_sem_copy, n):            # —Ñ—É–Ω–∫—Ü–∏—è, –ø—Ä–∏–∫—Ä–µ–ø–ª—è—é—â–∞—è inline-–∫–Ω–æ–ø–∫–∏ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é(–Ω–µ –±–æ–ª—å—à–µ 30 —Å–º–∏–≤–æ–ª–æ–≤!)
    markup = InlineKeyboardMarkup(row_width=3)
    for i in range(len(subjects_num_sem_copy)):
        if subjects_num_sem_copy[i] == '–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è –∏ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ':             #–æ–±—Ö–æ–¥–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –¥–ª–∏–Ω—É callback_data
            subjects_num_sem_copy[i] = '–∫–≥–∏–≥–º'
        elif subjects_num_sem_copy[i] == '—Ç–æ–ø–æ–ª–æ–≥–∏—è –∏ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è':             #–æ–±—Ö–æ–¥–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –¥–ª–∏–Ω—É callback_data
            subjects_num_sem_copy[i] = '—Ç–æ–ø–æ–ª–æ–≥–∏—è'
        elif subjects_num_sem_copy[i] == '–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤':
            subjects_num_sem_copy[i] ='–≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å'
        elif subjects_num_sem_copy[i] == '—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π':
            subjects_num_sem_copy[i] = '—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å'
        elif subjects_num_sem_copy[i] == '–º–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è —Ñ–∏–∑–∏–∫–æ - –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω':
            subjects_num_sem_copy[i] = '–º–µ—Ç–æ–¥–∏–∫–∞ —Ñ–º'
        elif subjects_num_sem_copy[i] == '–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤':
            subjects_num_sem_copy[i] = '–º–º—Ñ–ø'
        elif subjects_num_sem_copy[i] == '—Ä–∞–∑—Ä–µ—à–∏–º–æ—Å—Ç—å –Ω–µ–ª–∏–Ω–µ–π–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π':
            subjects_num_sem_copy[i] = '—Ä–Ω—É'
        markup.insert(InlineKeyboardButton(text=f'{i + 1}', callback_data=f'#{n}{subjects_num_sem_copy[i]}'))    #–ø—Ä–∏—Å—ã–ª–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞–µ—Ç–µ–ª—é —Å–ø–∏—Å–æ–∫ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ —Å–µ–º–µ—Å—Ç—Ä–µ
    return markup

max_count_page = 0
def markup_start_list(result, count):
    markup = InlineKeyboardMarkup(row_width=1)
    dict_size = ceil(len(result) / 7)
    global max_count_page
    max_count_page = dict_size - 1
    first_point = 0
    step = 7
    items = dict()
    for i in range(dict_size):
        items[i] = result[first_point:step]
        first_point = step
        step += 7
    result = items[count]
    for i in range(len(result)):
        if result[i] == '–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è –∏ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ':             #–æ–±—Ö–æ–¥–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –¥–ª–∏–Ω—É callback_data
            temp = '–∫–≥–∏–≥–º'
            markup.insert(InlineKeyboardButton(text=f'{result[i].capitalize()}', callback_data=f'%{temp}'))
        elif result[i] == '—Ç–æ–ø–æ–ª–æ–≥–∏—è –∏ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è':             #–æ–±—Ö–æ–¥–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ –¥–ª–∏–Ω—É callback_data
            temp = '—Ç–æ–ø–æ–ª–æ–≥–∏—è'
            markup.insert(InlineKeyboardButton(text=f'{result[i].capitalize()}', callback_data=f'%{temp}'))
        elif result[i] == '–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤':
            temp = '–≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å'
            markup.insert(InlineKeyboardButton(text=f'{result[i].capitalize()}', callback_data=f'%{temp}'))
        elif result[i] == '—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π':
            temp= '—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å'
            markup.insert(InlineKeyboardButton(text=f'{result[i].capitalize()}', callback_data=f'%{temp}'))
        elif result[i] == '–º–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è —Ñ–∏–∑–∏–∫–æ - –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω':
            temp = '–º–µ—Ç–æ–¥–∏–∫–∞ —Ñ–º'
            markup.insert(InlineKeyboardButton(text=f'{result[i].capitalize()}', callback_data=f'%{temp}'))
        elif result[i] == '–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤':
            temp = '–º–º—Ñ–ø'
            markup.insert(InlineKeyboardButton(text=f'{result[i].capitalize()}', callback_data=f'%{temp}'))
        elif result[i] == '—Ä–∞–∑—Ä–µ—à–∏–º–æ—Å—Ç—å –Ω–µ–ª–∏–Ω–µ–π–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π':
            temp = '—Ä–Ω—É'
            markup.insert(InlineKeyboardButton(text=f'{result[i].capitalize()}', callback_data=f'%{temp}'))
        else:
            markup.insert(InlineKeyboardButton(text=f'{result[i].capitalize()}', callback_data=f'%{result[i]}'))

    if count != 0 and count != max_count_page:
        markup.row(InlineKeyboardButton(text='‚¨Ö', callback_data=f'page_back{count}'), InlineKeyboardButton(text='‚û°',
                                                                                callback_data=f'page_next{count}'))
    elif count == 0:
        markup.row(InlineKeyboardButton(text='‚û°', callback_data=f'page_next{count}'))
    elif count == max_count_page:
        markup.row(InlineKeyboardButton(text='‚¨Ö', callback_data=f'page_back{count}'))
    return markup


bot = Bot(TOKEN)
dp = Dispatcher(bot, storage=MemoryStorage())
storage = MemoryStorage()

@dp.callback_query_handler(text_startswith="#")            #—Ö–µ–Ω–¥–ª–µ—Ä –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ markup –ø–æ –ø–æ–∏—Å–∫—É —Å–µ–º–µ—Å—Ç—Ä–∞
async def send_markup(call:CallbackQuery):
    num_sem = call.data[1]
    subject = call.data[2:]
    prefix = ""
    lst_link = []
    if subject == '–∫–≥–∏–≥–º':
        subject = '–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è –∏ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ'
    elif subject == '—Ç–æ–ø–æ–ª–æ–≥–∏—è':
        subject = '—Ç–æ–ø–æ–ª–æ–≥–∏—è –∏ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è'
    elif subject == '–≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å':
        subject = '–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤'
    elif subject == '—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å':
        subject = '—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π'
    elif subject == "–º–µ—Ç–æ–¥–∏–∫–∞ —Ñ–º":
        subject = '–º–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è —Ñ–∏–∑–∏–∫–æ - –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω'
    elif subject == '–º–º—Ñ–ø':
        subject = '–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤'
    elif subject == '—Ä–Ω—É':
        subject = '—Ä–∞–∑—Ä–µ—à–∏–º–æ—Å—Ç—å –Ω–µ–ª–∏–Ω–µ–π–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π'
    prefix = get_prefix(subject, num_sem)
    lst_link = get_data(subject, num_sem)
    books_name = get_books_name(subject, num_sem)
    for i in range(len(books_name)):
        books_name[i]=f'{i+1}. ' + books_name[i]
    string = ""
    head = f'‚úÖ–ù–∞–π–¥–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã {num_sem} - –≥–æ —Å–µ–º–µ—Å—Ç—Ä–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É "{subject.capitalize()}":\n\n'
    string = '\n \n'.join(books_name)
    await bot.send_message(call.from_user.id, head + string, reply_markup=make_murkup(prefix, lst_link))
    await call.answer()

@dp.callback_query_handler(text_startswith="%")     #–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–æ –ø–æ –æ–±—â–µ–≥–æ —Å–ø–∏—Å–∫–∞(–ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
async def send_start_list(call:CallbackQuery):
    subject = call.data[1:]
    if subject == '–∫–≥–∏–≥–º':
        subject = '–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è –∏ –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ'
    elif subject == '—Ç–æ–ø–æ–ª–æ–≥–∏—è':
        subject = '—Ç–æ–ø–æ–ª–æ–≥–∏—è –∏ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è'
    elif subject == '–≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å':
        subject = '–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É—Ä–∞–≤–Ω–µ–Ω–∏—è –≤ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–∏ –≥–∏—Å—Ç–µ—Ä–µ–∑–∏—Å–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤'
    elif subject == '—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å':
        subject = '—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Ä–µ—à–µ–Ω–∏–π –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π'
    elif subject == '–º–µ—Ç–æ–¥–∏–∫–∞ —Ñ–º':
        subject = '–º–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è —Ñ–∏–∑–∏–∫–æ - –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∏—Å—Ü–∏–ø–ª–∏–Ω'
    elif subject == '–º–º—Ñ–ø':
       subject = '–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤'
    elif subject == '—Ä–Ω—É':
        subject = '—Ä–∞–∑—Ä–µ—à–∏–º–æ—Å—Ç—å –Ω–µ–ª–∏–Ω–µ–π–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π'
    name_books_for_name_subj = get_all_links_for_subject(subject)[0]
    code_of_books = get_all_links_for_subject(subject)[1]
    links_of_books = get_all_links_for_subject(subject)[2]  # —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤
    if len(name_books_for_name_subj) != 0:
        await call.message.reply(f'‚úÖ–ù–∞–π–¥–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ "{subject.capitalize()}" :')
        for i in range(len(name_books_for_name_subj)):
            name_books_for_name_subj[i] = f'{i + 1}. ' + name_books_for_name_subj[i]
        out = '\n \n'.join(name_books_for_name_subj)  # —Å—Ç—Ä–æ–∫–æ–≤–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —É—á–µ–±–Ω–∏–∫–æ–≤

        await call.message.answer(out, reply_markup=make_murkup(code_of_books, links_of_books))
    await call.answer()


@dp.callback_query_handler(text_startswith='page_')
async def pagination_on_markup(call:CallbackQuery):
    global max_count_page
    count = int(call.data[-1])
    call.data = call.data[:-1]
    if count == 0 and call.data == 'page_back':
        count = 0
    elif count == max_count_page and call.data == 'page_next':
        count = max_count_page
    else:
        if call.data == 'page_next':
            count += 1
        elif call.data == 'page_back':
            count -= 1
    await call.message.edit_reply_markup(reply_markup=markup_start_list(result, count))
    await call.answer()

@dp.callback_query_handler()
async def send_doc(call:CallbackQuery):
    for key in d:
        if call.data == key:
            await bot.send_document(call.from_user.id, document=d[key])
            await call.answer('–î–æ–∫—É–º–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω')
    await call.answer()



result = []
@dp.message_handler(commands=['start', 'show_subject_list'])         #—Å—Ç–∞–≤–∏–º —Ñ–∏–ª—å—Ç—Ä –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥—ã start
async def send_hello(message:Message):
    global result
    #–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
    string = ""
    if message.text == '/start':
        string = '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!–ù–∞–ø–∏—à–∏—Ç–µ –Ω–æ–º–µ—Ä —Å–µ–º–µc—Ç—Ä–∞ –ª–∏–±–æ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞. \n –ë–æ—Ç –Ω–∞–π–¥–µ—Ç —É—á–µ–±–Ω–∏–∫–∏ –ø–æ –ø—Ä–µ–¥–º–µ—Ç–∞–º –∏–∑ —Å–ø–∏—Å–∫–∞üëá'
    elif message.text == '/show_subject_list':
        string = '–í–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞–ºüëá'
    subjects = []
    for i in range(1, 9):
        subjects.append(get_subjects_for_num(i))
    result = []

    for el in subjects:
        for j in el:
            if j != None and j not in result:
                result.append(j)
    result = sorted(result)
    await message.answer(string, reply_markup=markup_start_list(result, 0))


    # –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

@dp.message_handler(commands=['help'])
async def send_help(message:Message):
    await message.reply('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ –ª–∏–±–æ –Ω–æ–º–µ—Ä —Å–µ–º–µ—Å—Ç—Ä–∞ –±–µ–∑ –∫–∞–≤—ã—á–µ–∫.\n–ü—Ä–∏–º–µ—Ä:\n–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ \n '
                         '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞ –º–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—â–∞—Ç—å:–º–∞—Ç–∞–Ω, —É–º—Ñ.')

@dp.message_handler(commands=['search_by_semester_number'])
async def send_subj_search_semestr(message:Message):
    await message.reply('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Å–µ–º–µ—Å—Ç—Ä–∞. –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Å 1-8 —Å–µ–º–µ—Å—Ç—Ä –≤–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ.\n–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:\n1 ')

@dp.message_handler(commands=['search_by_subject_name'])
async def send_sub_search_sub(message:Message):
    await message.reply('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞\n –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:\n–∞–ª–≥–µ–±—Ä–∞ ')

@dp.message_handler(commands=['report_an_error'])
async def send_an_error(message:Message):
    await message.reply('–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –Ω–∞—à–ª–∏ –æ—à–∏–±–∫—É –∏ —Ä–µ—à–∏–ª–∏ –æ –Ω–µ–π —Å–æ–æ–±—â–∏—Ç—å. –ù–∞–ø–∏—à–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞: @danil_ladyzhev')


@dp.message_handler(text=['1','2','3','4','5','6','7','8'])         #–∑–∞–¥–∞–ª–∏ —Ñ–∏–ª—å—Ç—Ä –Ω–∞ –ø–æ–ª–µ text –æ–±—ä–µ–∫—Ç–∞ message
async def send_subj_cont(message:Message):
    n = int(message.text)                                           #–Ω–æ–º–µ—Ä —Å–µ–º–µ—Å—Ç—Ä–∞
    subjects_num_sem = get_subjects_for_num(n)                      #–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–µ—Ä–¥–º–µ—Ç–æ–≤ —Å–µ–º–µ—Å—Ç—Ä–∞ ‚Ññ n
    subjects_num_sem_copy = get_subjects_for_num(n)
    for j in range(len(subjects_num_sem)):                          #—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å–æ–≥–ª–∞—Å–Ω—É –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏–Ω—Ñ–æ–º–∞—Ä—Ü–∏–∏
        subjects_num_sem[j] = f"{j+1}.  " + subjects_num_sem[j].capitalize()
    temp = '\n \n'.join(subjects_num_sem)
    await message.answer('–ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Å–µ–º–µ—Å—Ç—Ä–∞üïó')
    await message.reply(f'‚úÖ–ù–∞–π–¥–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã {n} - –≥–æ —Å–µ–º–µ—Å—Ç—Ä–∞ :')
    await message.answer(temp, reply_markup=make_temp_murkup(subjects_num_sem_copy, n))        #–ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –≤—ã–±–æ—Ä–æ–º –ø—Ä–µ–¥–º–µ—Ç–∞ –∫ —Å—Ñ–æ—Ä–º–∞—Ä–æ–≤–∞–Ω–Ω–æ–º—É —Å–ø–∏—Å–∫—É –ø—Ä–µ–¥–º–µ—Ç–æ–≤


@dp.message_handler(content_types=['document'])
async def echo(message:Message):
    if message.from_user.id == admin_id:
        await message.reply(message.document.file_id)
    else:
        await message.delete()
    #await message.answer(message)
    #await message.forward(chat_id=chat_for_books_id)


class Get_File(StatesGroup):
    get_file = State()


@dp.message_handler(commands=['suggest_books'])
async def echo_suggest(message: Message):
    await Get_File.get_file.set()
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
    kb_2 = KeyboardButton('–í—ã–π—Ç–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞')
    kb.add( kb_2)
    await message.answer('–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–∫—É–º–µ–Ω—Ç. \n –ü–æ–¥–ø–∏—à–∏—Ç–µ –µ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:'
                         ' –ù–∞–∑–≤–∞–Ω–∏–µ —É—á–µ–±–Ω–∏–∫–∞, –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞, –Ω–æ–º–µ—Ä —Å–µ–º–µ—Å—Ç—Ä–∞ –∏  –∞–≤—Ç–æ—Ä.\n \n  '
                         '–ü—Ä–∏–º–µ—Ä: –õ–∏–Ω–µ–π–Ω—ã–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞, –ê–ª–≥–µ–±—Ä–∞, 1 —Å–µ–º–µ—Å—Ç—Ä,  –¢—É—Ä–±–∏–Ω –ú.–í. –ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª,'
                         ' —Ç–æ –Ω–∞–∂–º–∏—Ç–µ "–í—ã–π—Ç–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞" ', reply_markup=kb)


@dp.message_handler(state=Get_File.get_file, content_types=['document'])
async def forward(message:Message, state:FSMContext):
    try:
        await message.forward(chat_id=chat_for_books_id)
        await state.finish()
        await message.answer('–£—á–µ–±–Ω–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É.')
    except:
        await message.answer('–í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–∞–π–ª –Ω–µ –≤ —Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.'
                             ' –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏—Å–ª–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ pdf. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏'
                             ' –∏–∑ —Ä–µ–∂–∏–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ - –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ "–í—ã–π—Ç–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞" ')


@dp.message_handler(text=['–í—ã–π—Ç–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞'], state=Get_File.get_file)
async def exit_func(message:Message, state:FSMContext):
    await state.finish()
    await message.answer('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞.')


@dp.message_handler(state=Get_File.get_file)
async def forward_book(message:Message, state:FSMContext):
    try:
        await bot.send_document(chat_id=chat_for_books_id, document=message.document.file_id)
        await message.answer('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç –∏–ª–∏ –≤—ã–π–¥–∏—Ç–µ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞.')
    except:
        await message.answer('–í—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–∞–π–ª –Ω–µ –≤ —Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏—Å–ª–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ pdf.'
                             ' –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏'
                             ' –∏–∑ —Ä–µ–∂–∏–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ - –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ "–í—ã–π—Ç–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞" ')

@dp.message_handler()
async def send_book(message:Message):
   subject = message.text.lower().split()
   subject = ' '.join(subject)
   bol = False
   for key in d_subjects:
       if subject == key:
           subject = d_subjects[key]
           #bol = True
   await message.answer('–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –ø—Ä–µ–¥–º–µ—Ç–∞üïó')
   name_books_for_name_subj = get_all_links_for_subject(subject)[0]
   code_of_books = get_all_links_for_subject(subject)[1]
   links_of_books =  get_all_links_for_subject(subject)[2] # —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤
   if len(name_books_for_name_subj) != 0:
       await message.reply(f'‚úÖ–ù–∞–π–¥–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–µ "{subject.capitalize()}" :')
       for i in range(len(name_books_for_name_subj)):
           name_books_for_name_subj[i] = f'{i + 1}. ' + name_books_for_name_subj[i]
       out = '\n \n'.join(name_books_for_name_subj)             #—Å—Ç—Ä–æ–∫–æ–≤–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è —É—á–µ–±–Ω–∏–∫–æ–≤

       await message.answer(out, reply_markup=make_murkup(code_of_books,links_of_books))
   else:
       lst_type_error = []
       for key in d_subjects:
           if subject[:3] in key and d_subjects[key] not in lst_type_error:
               lst_type_error.append(d_subjects[key])
       errors_suggest = ', '.join(lst_type_error)
       await message.answer(f'‚ùå–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.')
       if len(lst_type_error)  == 1:
           await message.answer('–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏—Å–∫–∞–ª–∏:')
           await message.answer(errors_suggest)
       elif len(lst_type_error) > 1:
           await message.answer('–í–æ–∑–º–æ–∂–Ω–æ, –≤—ã –∏—Å–∫–∞–ª–∏:')
           for i in range(len(lst_type_error)):
               await message.answer(f'{lst_type_error[i]}')

if __name__ == "__main__":
    executor.start_polling(dp, skip_updates=True)
